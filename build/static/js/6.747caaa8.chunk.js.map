{"version":3,"sources":["pages/CardEditor.tsx","utils/categoryManage.ts"],"names":["PageContainer","styled","main","_templateObject","MainContainer","div","_templateObject2","CardFormContainer","header","_templateObject3","EditorContainer","section","_templateObject4","FooterContainer","footer","_templateObject5","CardEditor","props","_this","Object","_Users_ziyue_workspace_card_study_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__","this","_Users_ziyue_workspace_card_study_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_4__","_Users_ziyue_workspace_card_study_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_5__","call","container","editor","title","desc","category","cardType","prevCategory","timer","saveCardForCategory","_ref","_Users_ziyue_workspace_card_study_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__","_Users_ziyue_workspace_card_study_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","a","mark","_callee","card","wrap","_context","prev","next","categoryManage","addCardByUlid","toast","success","stop","_x","apply","arguments","saveCard","_callee2","_assertThisInitialize","history","content","_ulid","_context2","_Users_ziyue_workspace_card_study_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_6__","getMarkdown","console","log","error","abrupt","generateUlid","authName","type","ulid","date","Date","localForage","setItem","goBack","titleHandler","e","target","value","descHandler","categoryHandler","state","location","React","createRef","loadStatus","clearInterval","Editor","el","current","initialEditType","previewStyle","height","concat","hideModeSwitch","initialValue","codeBlockLanguages","react__WEBPACK_IMPORTED_MODULE_9___default","createElement","components__WEBPACK_IMPORTED_MODULE_19__","defaultCategory","ref","text","onClick","Component","getListFromLocal","categorysLocal","getItem","sent","getLocalByUlid","categoryLocal","_callee3","_context3","cards","_callee4","_index","_context4","findIndex","val","splice","_callee5","currCategory","_context5","find","repaceCategoryByUlid","_callee6","newCategory","categorys","_categorys","_categoryIndex","_context6","_callee7","serverPromise","serverData","serverCategory","_context7","Api","syncCategory","json","data","_callee8","_context8","push","__webpack_exports__","getLocalCardsByUlid","removeLocalByUlid","removeCardsByUlid","syncCardsByUlid"],"mappings":"6hCAkBA,IAAMA,EAAgBC,IAAOC,KAAVC,KAKbC,EAAgBH,IAAOI,IAAVC,KAMbC,EAAoBN,IAAOO,OAAVC,KAIjBC,EAAkBT,IAAOU,QAAVC,KAKfC,EAAkBZ,IAAOa,OAAVC,KAUAC,cASnB,SAAAA,EAAYC,GAA4B,IAAAC,EAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAL,IACtCE,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAH,GAAAQ,KAAAH,KAAMJ,KATAQ,eAQgC,EAAAP,EAPhCQ,YAOgC,EAAAR,EANhCS,MAAgB,GAMgBT,EALhCU,KAAe,GAKiBV,EAJhCW,SAAmB,GAIaX,EAHhCY,SAAmB,SAGaZ,EAFhCa,aAAuB,GAESb,EADhCc,MAA+B,KACCd,EAkDxCe,oBAlDwC,eAAAC,EAAAf,OAAAgB,EAAA,EAAAhB,CAAAiB,EAAAC,EAAAC,KAkDlB,SAAAC,EAAOC,GAAP,OAAAJ,EAAAC,EAAAI,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EACdC,IAAeC,cAAc5B,EAAKW,SAAUW,GAD9B,OAEpBO,IAAMC,QAAQ,kBAFM,wBAAAN,EAAAO,SAAAV,MAlDkB,gBAAAW,GAAA,OAAAhB,EAAAiB,MAAA9B,KAAA+B,YAAA,GAAAlC,EAsDxCmC,SAtDwClC,OAAAgB,EAAA,EAAAhB,CAAAiB,EAAAC,EAAAC,KAsD7B,SAAAgB,IAAA,IAAAC,EAAA5B,EAAAC,EAAAC,EAAA2B,EAAAC,EAAAC,EAAAlB,EAAA,OAAAJ,EAAAC,EAAAI,KAAA,SAAAkB,GAAA,cAAAA,EAAAhB,KAAAgB,EAAAf,MAAA,UAAAW,EAAApC,OAAAyC,EAAA,EAAAzC,CAAAD,GACDS,EADC4B,EACD5B,MAAOC,EADN2B,EACM3B,KAAMC,EADZ0B,EACY1B,SACb2B,EAAYtC,EAAKD,MAAjBuC,QACFC,EAAkBvC,EAAKQ,OAAOmC,cACpCC,QAAQC,IAAIpC,EAAOC,GACdD,GAAUC,GAAS6B,EALf,CAAAE,EAAAf,KAAA,eAMPG,IAAMiB,MAAM,8CANLL,EAAAM,OAAA,wBASHP,EAAQQ,cACR1B,EAAiB,CACrB2B,SAAU,OACVxC,QACAC,OACAwC,KAAM,SACNC,KAAMX,EACNY,MAAO,IAAIC,KACXd,WAjBOE,EAAAf,KAAA,GAmBH1B,EAAKe,oBAAoBO,GAnBtB,eAAAmB,EAAAf,KAAA,GAoBH4B,IAAYC,QAAQ,eAAgB5C,GApBjC,QAqBT2B,EAAQkB,SArBC,yBAAAf,EAAAV,SAAAK,MAtD6BpC,EA6ExCyD,aAAe,SAACC,GACd1D,EAAKS,MAAQiD,EAAEC,OAAOC,OA9EgB5D,EAgFxC6D,YAAc,SAACH,GACb1D,EAAKU,KAAOgD,EAAEC,OAAOC,OAjFiB5D,EAmFxC8D,gBAAkB,SAACJ,GACjB1D,EAAKW,SAAW+C,EAAEC,OAAOC,OAlFzBhB,QAAQC,IAAI9C,GAF0B,IAG9BgE,EAAUhE,EAAMiE,SAAhBD,MACApD,EAAmBoD,EAAnBpD,SAAUuC,EAASa,EAATb,KAJoB,OAKtClD,EAAKW,SAAWA,EAChBX,EAAKY,SAAWsC,EAChBlD,EAAKO,UAAY0D,IAAMC,YACvBlE,EAAK+D,MAAQ,CACXI,YAAY,GATwBnE,sFAalCG,KAAKW,OACPsD,cAAcjE,KAAKW,mDAIrBX,KAAKK,OAAS,IAAI6D,IAAO,CACvBC,GAAInE,KAAKI,UAAUgE,QACnBC,gBAAiB,WACjBC,aAAc,WACdC,OAAM,GAAAC,OAAK,IAAL,MACNC,gBAAgB,EAChBC,aAAc,GACdC,mBAAoB,CAClB,aACA,OACA,QACA,SACA,aACA,OACA,SAKJlC,QAAQC,IAAI1C,KAAKK,yCAkDjB,OACEuE,EAAA5D,EAAA6D,cAAClG,EAAD,KACEiG,EAAA5D,EAAA6D,cAAC9F,EAAD,KACE6F,EAAA5D,EAAA6D,cAAC3F,EAAD,KACE0F,EAAA5D,EAAA6D,cAACC,EAAA,EAAD,CACExB,aAActD,KAAKsD,aACnBI,YAAa1D,KAAK0D,YAClBC,gBAAiB3D,KAAK2D,gBACtBoB,gBAAiB/E,KAAKU,gBAG1BkE,EAAA5D,EAAA6D,cAACxF,EAAD,CAAiB2F,IAAKhF,KAAKI,YAC3BwE,EAAA5D,EAAA6D,cAACrF,EAAD,KACEoF,EAAA5D,EAAA6D,cAACC,EAAA,EAAD,CAAYG,KAAK,eAAKC,QAASlF,KAAKgC,qBA7GRmD,6GC5CzBC,8EAAf,SAAAlE,IAAA,IAAAmE,EAAA,OAAAtE,EAAAC,EAAAI,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EAC+C4B,IAAYmC,QAAQ,aADnE,cACQD,EADRhE,EAAAkE,KAAAlE,EAAAuB,OAAA,SAESyC,GAAkB,IAF3B,wBAAAhE,EAAAO,SAAAV,sCAIesE,+EAAf,SAAAvD,EAA8Be,GAA9B,IAAAyC,EAAA,OAAA1E,EAAAC,EAAAI,KAAA,SAAAkB,GAAA,cAAAA,EAAAhB,KAAAgB,EAAAf,MAAA,cAAAe,EAAAf,KAAA,EAC4C4B,IAAYmC,QAAQtC,GADhE,cACQyC,EADRnD,EAAAiD,KAAAjD,EAAAM,OAAA,SAES6C,GAFT,wBAAAnD,EAAAV,SAAAK,wEAIA,SAAAyD,EAAmC1C,GAAnC,IAAAyC,EAAA,OAAA1E,EAAAC,EAAAI,KAAA,SAAAuE,GAAA,cAAAA,EAAArE,KAAAqE,EAAApE,MAAA,cAAAoE,EAAApE,KAAA,EAC4CiE,EAAexC,GAD3D,cACQyC,EADRE,EAAAJ,KAEE9C,QAAQC,IAAI+C,GAFdE,EAAA/C,OAAA,SAGU6C,GAAiBA,EAAcG,OAAU,IAHnD,wBAAAD,EAAA/D,SAAA8D,wEAKA,SAAAG,EAAiC7C,GAAjC,IAAAqC,EAAAS,EAAA,OAAA/E,EAAAC,EAAAI,KAAA,SAAA2E,GAAA,cAAAA,EAAAzE,KAAAyE,EAAAxE,MAAA,cAAAwE,EAAAxE,KAAA,EAC+C6D,IAD/C,UACQC,EADRU,EAAAR,QAEQO,EAAST,EAAeW,UAAU,SAAAC,GAAG,OAAIA,EAAIjD,OAASA,MAC9C,GAHhB,CAAA+C,EAAAxE,KAAA,eAII8D,EAAea,OAAOJ,EAAQ,GAJlCC,EAAAxE,KAAA,EAKU4B,IAAYC,QAAQ,YAAaiC,GAL3C,cAAAU,EAAAnD,OAAA,SAMWyC,GANX,cAAAU,EAAAnD,OAAA,SAQS,MART,yBAAAmD,EAAAnE,SAAAiE,wEAUA,SAAAM,EAAiCnD,GAAjC,IAAAqC,EAAAe,EAAA,OAAArF,EAAAC,EAAAI,KAAA,SAAAiF,GAAA,cAAAA,EAAA/E,KAAA+E,EAAA9E,MAAA,cAAA8E,EAAA9E,KAAA,EAC+C6D,IAD/C,UACQC,EADRgB,EAAAd,OAEQa,EAAef,EAAeiB,KAAK,SAAAL,GAAG,OAAIA,EAAIjD,OAASA,KAF/D,CAAAqD,EAAA9E,KAAA,eAII6E,EAAaR,MAAQ,GAJzBS,EAAA9E,KAAA,EAKU4B,IAAYC,QAAQ,YAAaiC,GAL3C,wBAAAgB,EAAAzE,SAAAuE,sCAQeI,mFAAf,SAAAC,EACExD,EACAyD,EACAC,GAHF,IAAAC,EAAAC,EAAA,OAAA7F,EAAAC,EAAAI,KAAA,SAAAyF,GAAA,cAAAA,EAAAvF,KAAAuF,EAAAtF,MAAA,UAKMoF,EAAaD,EACZA,EANP,CAAAG,EAAAtF,KAAA,eAAAsF,EAAAtF,KAAA,EAOuB6D,IAPvB,OAOIuB,EAPJE,EAAAtB,KAAA,WASMoB,EATN,CAAAE,EAAAtF,KAAA,eAUUqF,EAAiBD,EAAWX,UAAU,SAAAC,GAAG,OAAIA,EAAIjD,OAASA,MAC1C,GAX1B,CAAA6D,EAAAtF,KAAA,gBAYMoF,EAAWC,GAAkBH,EAZnCI,EAAAtF,KAAA,GAaY4B,IAAYC,QAAQ,YAAauD,GAb7C,yBAAAE,EAAAjF,SAAA4E,wEAsBA,SAAAM,EAA+B9D,GAA/B,IAAAqC,EAAAe,EAAAW,EAAAC,EAAAC,EAAA,OAAAlG,EAAAC,EAAAI,KAAA,SAAA8F,GAAA,cAAAA,EAAA5F,KAAA4F,EAAA3F,MAAA,cAAA2F,EAAA3F,KAAA,EAC+C6D,IAD/C,UACQC,EADR6B,EAAA3B,OAEQa,EAAef,EAAeiB,KAAK,SAAAL,GAAG,OAAIA,EAAIjD,OAASA,KAF/D,CAAAkE,EAAA3F,KAAA,gBAAA2F,EAAA3F,KAAA,EAIgC4F,IAAIC,aAAahB,GAJjD,cAIUW,EAJVG,EAAA3B,KAAA2B,EAAA3F,KAAA,GAK6BwF,EAAcM,OAL3C,WAKUL,EALVE,EAAA3B,OAMU0B,EAAiBD,EAAWM,MANtC,CAAAJ,EAAA3F,KAAA,gBAAA2F,EAAA3F,KAAA,GAQYgF,EAAqBvD,EAAMiE,EAAgB5B,GARvD,yBAAA6B,EAAAtF,SAAAkF,wEAmBA,SAAAS,EAA6BvE,EAAc7B,GAA3C,IAAAkE,EAAAe,EAAA,OAAArF,EAAAC,EAAAI,KAAA,SAAAoG,GAAA,cAAAA,EAAAlG,KAAAkG,EAAAjG,MAAA,cAAAiG,EAAAjG,KAAA,EAC+C6D,IAD/C,UACQC,EADRmC,EAAAjC,OAEQa,EAAef,EAAeiB,KAAK,SAAAL,GAAG,OAAIA,EAAIjD,OAASA,KAF/D,CAAAwE,EAAAjG,KAAA,gBAII6E,EAAaR,MAAM6B,KAAKtG,GAJ5BqG,EAAAjG,KAAA,EAKU4B,IAAYC,QAAQ,YAAaiC,GAL3C,OAAAmC,EAAAjG,KAAA,wBAAAiG,EAAA5E,OAAA,SAOW,MAPX,yBAAA4E,EAAA5F,SAAA2F,6BAUeG,EAAA,GACbtC,mBACAI,iBACAmC,gEACAC,8DACAC,8DACAC,4DACArG","file":"static/js/6.747caaa8.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport styled from 'styled-components';\nimport Editor from 'tui-editor';\nimport 'tui-editor/dist/tui-editor.css';\nimport 'tui-editor/dist/tui-editor-contents.css';\nimport localForage from 'localforage';\nimport 'codemirror/lib/codemirror.css';\nimport 'styles/pages/Editor.css';\nimport 'highlight.js/styles/atelier-lakeside-dark.css';\n// import Api from 'api';\nimport { CardForm, SaveButton } from 'components';\n// import { async } from 'q';\nimport { CardData } from 'types';\nimport categoryManage from 'utils/categoryManage';\nimport generateUlid from 'utils/generateUlid';\n\nconst PageContainer = styled.main`\n  width: 100%;\n  height: 100%;\n  background: var(--color-1);\n`;\nconst MainContainer = styled.div`\n  position: relative;\n  min-width: 800px;\n  max-width: 1080px;\n  margin: 0 auto;\n`;\nconst CardFormContainer = styled.header`\n  width: 100%;\n  padding-top: 10px;\n`;\nconst EditorContainer = styled.section`\n  width: 100%;\n  height: 100%;\n  background: #fff;\n`;\nconst FooterContainer = styled.footer`\n  height: 80px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n`;\ninterface State {\n  loadStatus?: boolean;\n}\n\nexport default class CardEditor extends Component<RouteComponentProps, State> {\n  private container: any;\n  private editor: any;\n  private title: string = '';\n  private desc: string = '';\n  private category: string = '';\n  private cardType: string = 'custom';\n  private prevCategory: string = '';\n  private timer: NodeJS.Timeout | null = null;\n  constructor(props: RouteComponentProps) {\n    super(props);\n    console.log(props);\n    const { state } = props.location;\n    const { category, type } = state;\n    this.category = category;\n    this.cardType = type;\n    this.container = React.createRef();\n    this.state = {\n      loadStatus: false,\n    };\n  }\n  componentWillUnmount() {\n    if (this.timer) {\n      clearInterval(this.timer);\n    }\n  }\n  componentDidMount() {\n    this.editor = new Editor({\n      el: this.container.current,\n      initialEditType: 'markdown',\n      previewStyle: 'vertical',\n      height: `${600}px`,\n      hideModeSwitch: true,\n      initialValue: '',\n      codeBlockLanguages: [\n        'javascript',\n        'bash',\n        'nginx',\n        'docker',\n        'typescript',\n        'html',\n        'css',\n      ],\n    });\n    // const timer = setInterval(this.saveArticleLocal, 1000 * 60);\n    // this.timer = timer;\n    console.log(this.editor);\n\n    // this.editor.on('load', (e: any) => {\n    //   // console.log(e)\n    // });\n    // this.editor.on('focus', (e: any) => {\n    //   // console.log(e);\n    // });\n    // this.editor.on('change', (e: any) => {\n    //   // console.log(e);\n    //   // console.log(this.editor.getMarkdown());\n    // });\n  }\n  saveCardForCategory = async (card: CardData) => {\n    await categoryManage.addCardByUlid(this.category, card);\n    toast.success('saved success!');\n  };\n  saveCard = async () => {\n    const { title, desc, category } = this;\n    const { history } = this.props;\n    const content: string = this.editor.getMarkdown();\n    console.log(title, desc);\n    if (!title && !desc && !content) {\n      toast.error('请输入完整信息');\n      return;\n    }\n    const _ulid = generateUlid();\n    const card: CardData = {\n      authName: 'hugh',\n      title,\n      desc,\n      type: 'client',\n      ulid: _ulid,\n      date: +new Date(),\n      content,\n    };\n    await this.saveCardForCategory(card);\n    await localForage.setItem('prevCategory', category);\n    history.goBack();\n  };\n  titleHandler = (e: React.ChangeEvent<HTMLInputElement>) => {\n    this.title = e.target.value;\n  };\n  descHandler = (e: React.ChangeEvent<HTMLInputElement>) => {\n    this.desc = e.target.value;\n  };\n  categoryHandler = (e: React.ChangeEvent<HTMLInputElement>) => {\n    this.category = e.target.value;\n  };\n  render() {\n    return (\n      <PageContainer>\n        <MainContainer>\n          <CardFormContainer>\n            <CardForm\n              titleHandler={this.titleHandler}\n              descHandler={this.descHandler}\n              categoryHandler={this.categoryHandler}\n              defaultCategory={this.prevCategory}\n            />\n          </CardFormContainer>\n          <EditorContainer ref={this.container} />\n          <FooterContainer>\n            <SaveButton text='保存' onClick={this.saveCard} />\n          </FooterContainer>\n        </MainContainer>\n      </PageContainer>\n    );\n  }\n}\n","import localForage from 'localforage';\nimport { CardData, CategoryData } from '../types';\nimport Api from 'api';\n\nasync function getListFromLocal() {\n  const categorysLocal: CategoryData[] = await localForage.getItem('categorys');\n  return categorysLocal || [];\n}\nasync function getLocalByUlid(ulid: string) {\n  const categoryLocal: CategoryData = await localForage.getItem(ulid);\n  return categoryLocal;\n}\nasync function getLocalCardsByUlid(ulid: string) {\n  const categoryLocal: CategoryData = await getLocalByUlid(ulid);\n  console.log(categoryLocal);\n  return (categoryLocal && categoryLocal.cards) || [];\n}\nasync function removeLocalByUlid(ulid: string) {\n  const categorysLocal: CategoryData[] = await getListFromLocal();\n  const _index = categorysLocal.findIndex(val => val.ulid === ulid);\n  if (_index > -1) {\n    categorysLocal.splice(_index, 1);\n    await localForage.setItem('categorys', categorysLocal);\n    return categorysLocal;\n  }\n  return null;\n}\nasync function removeCardsByUlid(ulid: string) {\n  const categorysLocal: CategoryData[] = await getListFromLocal();\n  const currCategory = categorysLocal.find(val => val.ulid === ulid);\n  if (currCategory) {\n    currCategory.cards = [];\n    await localForage.setItem('categorys', categorysLocal);\n  }\n}\nasync function repaceCategoryByUlid(\n  ulid: string,\n  newCategory: CategoryData,\n  categorys?: CategoryData[]\n) {\n  let _categorys = categorys;\n  if (!categorys) {\n    _categorys = await getListFromLocal();\n  }\n  if (_categorys) {\n    const _categoryIndex = _categorys.findIndex(val => val.ulid === ulid);\n    if (_categoryIndex > -1) {\n      _categorys[_categoryIndex] = newCategory;\n      await localForage.setItem('categorys', _categorys);\n    }\n  }\n}\n/**\n * 和服务器同步卡片，只同步本人创建的分类\n *\n * @param {string} ulid 分类uLid\n */\nasync function syncCardsByUlid(ulid: string) {\n  const categorysLocal: CategoryData[] = await getListFromLocal();\n  const currCategory = categorysLocal.find(val => val.ulid === ulid);\n  if (currCategory) {\n    const serverPromise = await Api.syncCategory(currCategory);\n    const serverData = await serverPromise.json();\n    const serverCategory = serverData.data;\n    if (serverCategory) {\n      await repaceCategoryByUlid(ulid, serverCategory, categorysLocal);\n    }\n  }\n}\n/**\n * 通过ulid添加卡片到本地\n *\n * @param {string} ulid\n * @param {CardData} card\n * @returns\n */\nasync function addCardByUlid(ulid: string, card: CardData) {\n  const categorysLocal: CategoryData[] = await getListFromLocal();\n  const currCategory = categorysLocal.find(val => val.ulid === ulid);\n  if (currCategory) {\n    currCategory.cards.push(card);\n    await localForage.setItem('categorys', categorysLocal);\n  } else {\n    return null;\n  }\n}\nexport default {\n  getListFromLocal,\n  getLocalByUlid,\n  getLocalCardsByUlid,\n  removeLocalByUlid,\n  removeCardsByUlid,\n  syncCardsByUlid,\n  addCardByUlid,\n};\n"],"sourceRoot":""}