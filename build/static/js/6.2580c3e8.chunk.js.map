{"version":3,"sources":["pages/CardEditor.tsx","utils/categoryManage.ts"],"names":["PageContainer","styled","main","_templateObject","MainContainer","div","_templateObject2","CardFormContainer","header","_templateObject3","EditorContainer","section","_templateObject4","FooterContainer","footer","_templateObject5","CardEditor","props","_this","Object","_Users_ziyue_workspace_card_study_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__","this","_Users_ziyue_workspace_card_study_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_4__","_Users_ziyue_workspace_card_study_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_5__","call","container","editor","title","desc","category","tags","cardType","prevCategory","timer","saveCardForCategory","_ref","_Users_ziyue_workspace_card_study_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__","_Users_ziyue_workspace_card_study_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","a","mark","_callee","card","wrap","_context","prev","next","categoryManage","addCardByUlid","toast","success","stop","_x","apply","arguments","saveCard","_callee2","_assertThisInitialize","history","content","_tags","_ulid","_context2","_Users_ziyue_workspace_card_study_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_6__","getMarkdown","console","log","error","abrupt","split","generateUlid","authName","type","ulid","date","Date","localForage","setItem","goBack","titleHandler","e","target","value","descHandler","tagsHandler","state","location","React","createRef","loadStatus","clearInterval","Editor","el","current","initialEditType","previewStyle","height","concat","hideModeSwitch","initialValue","codeBlockLanguages","react__WEBPACK_IMPORTED_MODULE_9___default","createElement","components__WEBPACK_IMPORTED_MODULE_19__","defaultCategory","ref","text","onClick","Component","getListFromLocal","categorysLocal","getItem","sent","getLocalByUlid","categoryLocal","_callee3","_context3","cards","_callee4","_index","_context4","findIndex","val","splice","_callee5","currCategory","_context5","find","repaceCategoryByUlid","_callee6","newCategory","categorys","_categorys","_categoryIndex","_context6","_callee7","serverPromise","serverData","serverCategory","_context7","Api","syncCategory","json","data","_callee8","_context8","push","__webpack_exports__","getLocalCardsByUlid","removeLocalByUlid","removeCardsByUlid","syncCardsByUlid"],"mappings":"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","file":"static/js/6.2580c3e8.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport styled from 'styled-components';\nimport Editor from 'tui-editor';\nimport 'tui-editor/dist/tui-editor.css';\nimport 'tui-editor/dist/tui-editor-contents.css';\nimport localForage from 'localforage';\nimport 'codemirror/lib/codemirror.css';\nimport 'styles/pages/Editor.css';\nimport 'highlight.js/styles/atelier-lakeside-dark.css';\n// import Api from 'api';\nimport { CardForm, SaveButton } from 'components';\n// import { async } from 'q';\nimport { CardData } from 'types';\nimport categoryManage from 'utils/categoryManage';\nimport generateUlid from 'utils/generateUlid';\n\nconst PageContainer = styled.main`\n  width: 100%;\n  height: 100%;\n  background: var(--color-1);\n`;\nconst MainContainer = styled.div`\n  position: relative;\n  min-width: 800px;\n  max-width: 1080px;\n  margin: 0 auto;\n`;\nconst CardFormContainer = styled.header`\n  width: 100%;\n  padding-top: 10px;\n`;\nconst EditorContainer = styled.section`\n  width: 100%;\n  height: 100%;\n  background: #fff;\n`;\nconst FooterContainer = styled.footer`\n  height: 80px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n`;\ninterface State {\n  loadStatus?: boolean;\n}\n\nexport default class CardEditor extends Component<RouteComponentProps, State> {\n  private container: any;\n  private editor: any;\n  private title: string = '';\n  private desc: string = '';\n  private category: string = '';\n  private tags: string = '';\n  private cardType: string = 'custom';\n  private prevCategory: string = '';\n  private timer: NodeJS.Timeout | null = null;\n  constructor(props: RouteComponentProps) {\n    super(props);\n    console.log(props);\n    const { state } = props.location;\n    const { category, type } = state;\n    this.category = category;\n    this.cardType = type;\n    this.container = React.createRef();\n    this.state = {\n      loadStatus: false,\n    };\n  }\n  componentWillUnmount() {\n    if (this.timer) {\n      clearInterval(this.timer);\n    }\n  }\n  componentDidMount() {\n    this.editor = new Editor({\n      el: this.container.current,\n      initialEditType: 'markdown',\n      previewStyle: 'vertical',\n      height: `${600}px`,\n      hideModeSwitch: true,\n      initialValue: '',\n      codeBlockLanguages: [\n        'javascript',\n        'bash',\n        'nginx',\n        'docker',\n        'typescript',\n        'html',\n        'css',\n      ],\n    });\n    // const timer = setInterval(this.saveArticleLocal, 1000 * 60);\n    // this.timer = timer;\n    console.log(this.editor);\n\n    // this.editor.on('load', (e: any) => {\n    //   // console.log(e)\n    // });\n    // this.editor.on('focus', (e: any) => {\n    //   // console.log(e);\n    // });\n    // this.editor.on('change', (e: any) => {\n    //   // console.log(e);\n    //   // console.log(this.editor.getMarkdown());\n    // });\n  }\n  saveCardForCategory = async (card: CardData) => {\n    await categoryManage.addCardByUlid(this.category, card);\n    toast.success('saved success!');\n  };\n  saveCard = async () => {\n    const { title, desc, category, tags } = this;\n    const { history } = this.props;\n    const content: string = this.editor.getMarkdown();\n    console.log(title, desc);\n    if (!title && !desc && !content) {\n      toast.error('请输入完整信息');\n      return;\n    }\n    const _tags = tags.split(/[，,]/);\n    const _ulid = generateUlid();\n    const card: CardData = {\n      authName: 'hugh',\n      title,\n      desc,\n      tags: _tags,\n      type: 'client',\n      ulid: _ulid,\n      date: +new Date(),\n      content,\n    };\n    await this.saveCardForCategory(card);\n    await localForage.setItem('prevCategory', category);\n    history.goBack();\n  };\n  titleHandler = (e: React.ChangeEvent<HTMLInputElement>) => {\n    this.title = e.target.value;\n  };\n  descHandler = (e: React.ChangeEvent<HTMLInputElement>) => {\n    this.desc = e.target.value;\n  };\n  tagsHandler = (e: React.ChangeEvent<HTMLInputElement>) => {\n    this.tags = e.target.value;\n  };\n  render() {\n    return (\n      <PageContainer>\n        <MainContainer>\n          <CardFormContainer>\n            <CardForm\n              titleHandler={this.titleHandler}\n              descHandler={this.descHandler}\n              tagsHandler={this.tagsHandler}\n              defaultCategory={this.prevCategory}\n            />\n          </CardFormContainer>\n          <EditorContainer ref={this.container} />\n          <FooterContainer>\n            <SaveButton text='保存' onClick={this.saveCard} />\n          </FooterContainer>\n        </MainContainer>\n      </PageContainer>\n    );\n  }\n}\n","import localForage from 'localforage';\nimport { CardData, CategoryData } from '../types';\nimport Api from 'api';\n\nasync function getListFromLocal() {\n  const categorysLocal: CategoryData[] = await localForage.getItem('categorys');\n  return categorysLocal || [];\n}\nasync function getLocalByUlid(ulid: string) {\n  const categoryLocal: CategoryData = await localForage.getItem(ulid);\n  return categoryLocal;\n}\nasync function getLocalCardsByUlid(ulid: string) {\n  const categoryLocal: CategoryData = await getLocalByUlid(ulid);\n  console.log(categoryLocal);\n  return (categoryLocal && categoryLocal.cards) || [];\n}\nasync function removeLocalByUlid(ulid: string) {\n  const categorysLocal: CategoryData[] = await getListFromLocal();\n  const _index = categorysLocal.findIndex(val => val.ulid === ulid);\n  if (_index > -1) {\n    categorysLocal.splice(_index, 1);\n    await localForage.setItem('categorys', categorysLocal);\n    return categorysLocal;\n  }\n  return null;\n}\nasync function removeCardsByUlid(ulid: string) {\n  const categorysLocal: CategoryData[] = await getListFromLocal();\n  const currCategory = categorysLocal.find(val => val.ulid === ulid);\n  if (currCategory) {\n    currCategory.cards = [];\n    await localForage.setItem('categorys', categorysLocal);\n  }\n}\nasync function repaceCategoryByUlid(\n  ulid: string,\n  newCategory: CategoryData,\n  categorys?: CategoryData[]\n) {\n  let _categorys = categorys;\n  if (!categorys) {\n    _categorys = await getListFromLocal();\n  }\n  if (_categorys) {\n    const _categoryIndex = _categorys.findIndex(val => val.ulid === ulid);\n    if (_categoryIndex > -1) {\n      _categorys[_categoryIndex] = newCategory;\n      await localForage.setItem('categorys', _categorys);\n    }\n  }\n}\n/**\n * 和服务器同步卡片，只同步本人创建的分类\n *\n * @param {string} ulid 分类uLid\n */\nasync function syncCardsByUlid(ulid: string) {\n  const categorysLocal: CategoryData[] = await getListFromLocal();\n  const currCategory = categorysLocal.find(val => val.ulid === ulid);\n  if (currCategory) {\n    const serverPromise = await Api.syncCategory(currCategory);\n    const serverData = await serverPromise.json();\n    const serverCategory = serverData.data;\n    if (serverCategory) {\n      await repaceCategoryByUlid(ulid, serverCategory, categorysLocal);\n    }\n  }\n}\n/**\n * 通过ulid添加卡片到本地\n *\n * @param {string} ulid\n * @param {CardData} card\n * @returns\n */\nasync function addCardByUlid(ulid: string, card: CardData) {\n  const categorysLocal: CategoryData[] = await getListFromLocal();\n  const currCategory = categorysLocal.find(val => val.ulid === ulid);\n  if (currCategory) {\n    currCategory.cards.push(card);\n    await localForage.setItem('categorys', categorysLocal);\n  } else {\n    return null;\n  }\n}\nexport default {\n  getListFromLocal,\n  getLocalByUlid,\n  getLocalCardsByUlid,\n  removeLocalByUlid,\n  removeCardsByUlid,\n  syncCardsByUlid,\n  addCardByUlid,\n};\n"],"sourceRoot":""}