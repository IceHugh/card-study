{"version":3,"sources":["pages/Editor.tsx"],"names":["ToolBarBox","styled","nav","_templateObject","EditorContainer","section","_templateObject2","PageContainer","main","_templateObject3","EditorPage","props","_this","Object","_Users_ziyue_workspace_blog_blog_admin_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_4__","this","_Users_ziyue_workspace_blog_blog_admin_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_6__","_Users_ziyue_workspace_blog_blog_admin_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_7__","call","container","editor","articleId","timer","saveArticleLocal","_Users_ziyue_workspace_blog_blog_admin_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3__","_Users_ziyue_workspace_blog_blog_admin_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default","a","mark","_callee","_md","wrap","_context","prev","next","getMarkdown","localForage","setItem","toast","success","console","log","t0","error","stop","restoryArticeLocal","_callee2","localMd","_context2","getItem","sent","mdEditor","setValue","getArticleDetail","_callee3","detailRes","detailJson","content","_context3","abrupt","Api","getPostDetail","id","json","data","saveClick","_callee4","history","titleArr","title","tagsCatDate","queryPost","postRes","_postRes","_context4","state","loadStatus","setState","match","pickTagCatDate","_Users_ziyue_workspace_blog_blog_admin_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__","desc","patchPost","goBack","postPost","msg","finish","md","descArr","descSplit","descSplit1","split","tags","category","time","Date","forEach","val","test","resolveArrText","resolveText","str","vals","replace","concat","trim","map","v","_Users_ziyue_workspace_blog_blog_admin_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__","Set","location","React","createRef","clearInterval","pageHeight","current","clientHeight","Editor","el","initialEditType","previewStyle","height","hideModeSwitch","initialValue","codeBlockLanguages","setInterval","on","e","react__WEBPACK_IMPORTED_MODULE_10___default","createElement","ref","components_EditorTool__WEBPACK_IMPORTED_MODULE_21__","load","onClick","Component"],"mappings":"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","file":"static/js/4.2226c887.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport styled from 'styled-components';\nimport Editor from 'tui-editor';\nimport 'tui-editor/dist/tui-editor.css';\nimport 'tui-editor/dist/tui-editor-contents.css';\nimport localForage from 'localforage';\n// import 'highlight.js/styles/github.css';\nimport 'codemirror/lib/codemirror.css';\nimport 'styles/pages/Editor.css';\nimport 'highlight.js/styles/atelier-lakeside-dark.css';\nimport Api from 'api';\n\nimport ToolBar from 'components/EditorTool';\nconst ToolBarBox = styled.nav`\n  position: absolute;\n  top: 0px;\n  left: 540px;\n  height: 31px;\n  overflow: hidden;\n  z-index: 2;\n`\nconst EditorContainer = styled.section`\n  width: 100%;\n  height: 100%;\n`\nconst PageContainer = styled.main`\n  width: 100%;\n  height: 100%;\n  position: relative;\n  min-width: 1080px;\n`\ninterface props extends RouteComponentProps {\n}\ninterface state {\n  loadStatus?: boolean\n}\n\nexport default class EditorPage extends Component<props, state> {\n  private container: any;\n  private editor: any;\n  private PageContainer: any;\n  private articleId: string = '';\n  private timer: NodeJS.Timeout | null = null;\n  constructor(props: any) {\n    super(props);\n    console.log(props);\n    const { state } = props.location;\n    if (state) {\n      this.articleId = state.id;\n      console.log(state.id);\n    }\n    this.container = React.createRef();\n    this.PageContainer = React.createRef();\n    this.state = {\n      loadStatus: false,\n    }\n  }\n  componentWillUnmount() {\n    if (this.timer) {\n      clearInterval(this.timer);\n    }\n  }\n  componentDidMount() {\n    const pageHeight = this.PageContainer.current.clientHeight;\n    console.log(pageHeight);\n    this.editor = new Editor({\n      el: this.container.current,\n      initialEditType: 'markdown',\n      previewStyle: 'vertical',\n      height: `${pageHeight}px`,\n      hideModeSwitch: true,\n      initialValue: '',\n      codeBlockLanguages: ['javascript', 'bash', 'nginx', 'docker', 'typescript', 'html', 'css'],\n    });\n    const timer = setInterval(this.saveArticleLocal, 1000 * 60);\n    this.timer = timer;\n    console.log(this.editor);\n    this.getArticleDetail();\n    \n    this.editor.on('load', (e: any) => {\n      // console.log(e)\n    });\n    this.editor.on('focus', (e: any) => {\n      // console.log(e);\n    });\n    this.editor.on('change', (e: any) => {\n      // console.log(e);\n      // console.log(this.editor.getMarkdown());\n    });\n  }\n  saveArticleLocal = async () => {\n    const _md: string = this.editor.getMarkdown();\n    try {\n      await localForage.setItem('article', _md);\n      toast.success('saved success!');\n      console.log('本地保存成功');\n    } catch (error) {\n      toast.error('saved error!');\n      console.log('本地保存失败');\n    }\n  }\n  restoryArticeLocal = async () => {\n    const localMd = await localForage.getItem('article');\n    if (localMd) {\n      this.editor.mdEditor.setValue(localMd);\n    }\n  }\n  getArticleDetail = async () => {\n    if (!this.articleId) {\n      this.restoryArticeLocal();\n      return;\n    };\n    try {\n      const detailRes = await Api.getPostDetail({ id: this.articleId });\n      const detailJson = await detailRes.json();\n      let { content } = detailJson.data;\n      // content = content.replace('↵', '\\n');\n      this.editor.mdEditor.setValue(content);\n      return detailJson;\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  saveClick = async () => {\n    const { history } = this.props;\n    let { loadStatus } = this.state;\n    if (loadStatus) return;\n    this.setState({\n      loadStatus: true,\n    });\n    const _md: string = this.editor.getMarkdown();\n    // console.log(_md);\n    const titleArr: RegExpMatchArray | null = _md.match(/#\\s?(\\S*)\\r?\\s?/);\n    const title = titleArr && titleArr[1];\n    const tagsCatDate = this.pickTagCatDate(_md);\n    try {\n      const queryPost = {\n        title,\n        content: _md,\n        desc: '',\n        ...tagsCatDate,\n      }\n      console.log(queryPost);\n      if (this.articleId) {\n        const postRes = await Api.patchPost({\n          id: this.articleId,\n          ...queryPost,\n        });\n        history.goBack();\n        console.log(postRes);\n      } else {\n        const postRes = await Api.postPost(queryPost);\n        console.log(postRes);\n        history.goBack();\n      }\n    } catch (err) {\n      toast(err.msg || 'saved error');\n      console.log(err);\n    } finally {\n      this.setState({\n        loadStatus: false,\n      });\n    }\n  }\n  pickTagCatDate = (md: string) => {\n    const descArr: RegExpMatchArray | null  = md.match(/&{3}([\\S\\s]*)&{3}/);\n    const descSplit = (descArr && descArr[1]) || '';\n    console.log(descSplit);\n    const descSplit1 = descSplit.split(/\\r?\\n/);\n    let tags: string[] = [];\n    let category: string[] = [];\n    let time = +new Date();\n    descSplit1.forEach(val => {\n      if (val !== '') {\n        if (/tags/g.test(val)) {\n          tags = this.resolveArrText('tags', val);\n        } else if (/category/g.test(val)) {\n          category = this.resolveArrText('category', val);\n        } else if (/date/g.test(val)) {\n          time = this.resolveText('date', val);\n        }\n      }\n    });\n    return {\n      tags,\n      category,\n      time,\n    }\n  }\n  resolveText = (str: string, val: string): number => {\n    let vals = val.replace(`${str}:`, '');\n    vals = vals.trim();\n    return +new Date(vals);\n  }\n  resolveArrText = (str: string, val: string): string[] => {\n    let vals = val.replace(`${str}:`, '').split(',');\n    vals = vals.map(v => v.trim());\n    return [...new Set([...vals])];\n  }\n  render() {\n    return (\n      <PageContainer ref={this.PageContainer}>\n        <ToolBarBox>\n          <ToolBar load={this.state.loadStatus} onClick={this.saveClick}/>\n        </ToolBarBox>\n        <EditorContainer ref={this.container}/>>\n      </PageContainer>\n    )\n  }\n}"],"sourceRoot":""}